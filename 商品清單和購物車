using System;
using System.Collections.Generic;
using System.Data;
using System.Data.SqlClient;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;

namespace 組別作品
{
    public partial class WebForm2 : System.Web.UI.Page
    {
        public string s_data = SiteMaster.s_data;
        public string custermer = "123@123";//可變動的
        public int custermerID = 1;//可變動的


        protected void Page_Load(object sender, EventArgs e)
        {
            SqlConnection connection = new SqlConnection(s_data);
            SqlCommand command = new SqlCommand($"select * from products where id={Request.QueryString["productID"]}", connection);
            connection.Open();
            SqlDataReader reader = command.ExecuteReader();
            if (reader.HasRows)
            {
                while (reader.Read())
                {
                    lb_title.Text = ""+reader["title"];
                    lb_price.Text = "" + reader["price"];
                    lb_describe.Text = "" + reader["describe"];
                }
            }
            connection.Close();





        }

        protected void btn_addToCart_Click(object sender, EventArgs e)
        {
         //把購物車存到sql
                Button product = (Button)sender;
                SqlConnection connection = new SqlConnection(s_data);
                connection.Open();
                string sql = $"insert into[cart_{custermer}](productID)values(@productID)";
                SqlCommand sqlCommand = new SqlCommand(sql, connection);
                sqlCommand.Parameters.Add("@productID", SqlDbType.Int);
                sqlCommand.Parameters["@productID"].Value = Request.QueryString["productID"];
                sqlCommand.ExecuteNonQuery();
                connection.Close();
        }




    }
}
//------------------------------------------------------------------------------
// <自動產生的>
//     這段程式碼是由工具產生的。
//
//     變更這個檔案可能會導致不正確的行為，而且如果已重新產生
//     程式碼，則會遺失變更。
// </自動產生的>
//------------------------------------------------------------------------------

namespace 組別作品
{


    public partial class WebForm2
    {

        /// <summary>
        /// Panel1 控制項。
        /// </summary>
        /// <remarks>
        /// 自動產生的欄位。
        /// 若要修改，請將欄位宣告從設計工具檔案移到程式碼後置檔案。
        /// </remarks>
        protected global::System.Web.UI.WebControls.Panel Panel1;

        /// <summary>
        /// lb_title 控制項。
        /// </summary>
        /// <remarks>
        /// 自動產生的欄位。
        /// 若要修改，請將欄位宣告從設計工具檔案移到程式碼後置檔案。
        /// </remarks>
        protected global::System.Web.UI.WebControls.Label lb_title;

        /// <summary>
        /// lb_price 控制項。
        /// </summary>
        /// <remarks>
        /// 自動產生的欄位。
        /// 若要修改，請將欄位宣告從設計工具檔案移到程式碼後置檔案。
        /// </remarks>
        protected global::System.Web.UI.WebControls.Label lb_price;

        /// <summary>
        /// btn_addToCart 控制項。
        /// </summary>
        /// <remarks>
        /// 自動產生的欄位。
        /// 若要修改，請將欄位宣告從設計工具檔案移到程式碼後置檔案。
        /// </remarks>
        protected global::System.Web.UI.WebControls.Button btn_addToCart;

        /// <summary>
        /// lb_describe 控制項。
        /// </summary>
        /// <remarks>
        /// 自動產生的欄位。
        /// 若要修改，請將欄位宣告從設計工具檔案移到程式碼後置檔案。
        /// </remarks>
        protected global::System.Web.UI.WebControls.Label lb_describe;
    }
}

<%@ Page Title="" Language="C#" MasterPageFile="~/Site.Master" AutoEventWireup="true" CodeBehind="productList.aspx.cs" Inherits="組別作品.WebForm1" %>
<asp:Content ID="Content1" ContentPlaceHolderID="MainContent" runat="server">

    <asp:SqlDataSource ID="SqlDataSource1" runat="server" ConnectionString="<%$ ConnectionStrings:測試用資料庫01ConnectionString %>" SelectCommand="SELECT * FROM [products]"></asp:SqlDataSource>

<%--    <asp:Button ID="Button1" runat="server" Text="Button" OnClick="Button1_Click" />--%>
<%--    <input id="Button2" runat="server" type="submit" value="button" onServerClick="Button2_Click" />--%>
    <asp:Panel ID="Panel1" runat="server"></asp:Panel>
</asp:Content>

using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Data.SqlClient;
using System.Data;

namespace 組別作品
{
    public partial class WebForm1 : System.Web.UI.Page
    {
        public string s_data = SiteMaster.s_data;
        public string custermer = "123@123";//可變動的
        public int custermerID = 1;//可變動的

        protected void Page_Load(object sender, EventArgs e)
        {
            string template = "";
            SqlConnection connection = new SqlConnection(s_data);
            SqlCommand command = new SqlCommand("select * from products",connection);
            connection.Open();
            SqlDataReader reader = command.ExecuteReader();
            if (reader.HasRows)
            {
                while (reader.Read())
                {

                    #region asp的動態生成


                    Panel productBox = new Panel();
                    productBox.CssClass = "product_box";
                    Panel1.Controls.Add(productBox);

                    HyperLink linkBox = new HyperLink();
                    linkBox.NavigateUrl = $"https://localhost:44374/productDetail?productID={reader["id"]}";
                    productBox.Controls.Add(linkBox);

                    Image img = new Image();
                    img.ImageUrl = @"~/images/" +reader["id"]+ ".jpg";
                    linkBox.Controls.Add(img);

                    Label title = new Label();
                    title.Text =reader["title"].ToString();
                    linkBox.Controls.Add(title);

                    Button btn = new Button();
                    btn.ID = ""+reader["id"];
                    btn.Text = "加入購物車";
                    btn.Click += new EventHandler(addToCart);
                    productBox.Controls.Add(btn);
                    
                    
                    
                    #endregion
                }
            }

            connection.Close();
           



        }

     

        protected void addToCart(object sender, EventArgs e)
        {

            //把購物車存到sql
            Button product = (Button)sender;
            SqlConnection connection = new SqlConnection(s_data);
            connection.Open();
            string sql = $"insert into[cart_{custermer}](productID)values(@productID)";
            SqlCommand sqlCommand = new SqlCommand(sql, connection);
            sqlCommand.Parameters.Add("@productID", SqlDbType.Int);
            sqlCommand.Parameters["@productID"].Value= product.ID;
            sqlCommand.ExecuteNonQuery();
            connection.Close();
        }


    }
}
//------------------------------------------------------------------------------
// <自動產生的>
//     這段程式碼是由工具產生的。
//
//     變更這個檔案可能會導致不正確的行為，而且如果已重新產生
//     程式碼，則會遺失變更。
// </自動產生的>
//------------------------------------------------------------------------------

namespace 組別作品
{


    public partial class WebForm1
    {

        /// <summary>
        /// SqlDataSource1 控制項。
        /// </summary>
        /// <remarks>
        /// 自動產生的欄位。
        /// 若要修改，請將欄位宣告從設計工具檔案移到程式碼後置檔案。
        /// </remarks>
        protected global::System.Web.UI.WebControls.SqlDataSource SqlDataSource1;

        /// <summary>
        /// Panel1 控制項。
        /// </summary>
        /// <remarks>
        /// 自動產生的欄位。
        /// 若要修改，請將欄位宣告從設計工具檔案移到程式碼後置檔案。
        /// </remarks>
        protected global::System.Web.UI.WebControls.Panel Panel1;
    }
}

<%@ Master Language="C#" AutoEventWireup="true" CodeBehind="Site.master.cs" Inherits="組別作品.SiteMaster" %>

<!DOCTYPE html>

<html lang="zh">
<head runat="server">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%: Page.Title %> - 我的 ASP.NET  應用程式</title>

    <asp:PlaceHolder runat="server">
        <%: Scripts.Render("~/bundles/modernizr") %>
    </asp:PlaceHolder>

    <webopt:bundlereference runat="server" path="~/Content/css" />
    <link href="~/favicon.ico" rel="shortcut icon" type="image/x-icon" />


    <link href="css/all.css" rel="stylesheet" type="text/css">
</head>
<body>
    <form runat="server">
        <asp:ScriptManager runat="server">
            <Scripts>
                <%--To learn more about bundling scripts in ScriptManager see https://go.microsoft.com/fwlink/?LinkID=301884 --%>
                <%--Framework Scripts--%>
                <asp:ScriptReference Name="MsAjaxBundle" />
                <asp:ScriptReference Name="jquery" />
                <asp:ScriptReference Name="bootstrap" />
                <asp:ScriptReference Name="WebForms.js" Assembly="System.Web" Path="~/Scripts/WebForms/WebForms.js" />
                <asp:ScriptReference Name="WebUIValidation.js" Assembly="System.Web" Path="~/Scripts/WebForms/WebUIValidation.js" />
                <asp:ScriptReference Name="MenuStandards.js" Assembly="System.Web" Path="~/Scripts/WebForms/MenuStandards.js" />
                <asp:ScriptReference Name="GridView.js" Assembly="System.Web" Path="~/Scripts/WebForms/GridView.js" />
                <asp:ScriptReference Name="DetailsView.js" Assembly="System.Web" Path="~/Scripts/WebForms/DetailsView.js" />
                <asp:ScriptReference Name="TreeView.js" Assembly="System.Web" Path="~/Scripts/WebForms/TreeView.js" />
                <asp:ScriptReference Name="WebParts.js" Assembly="System.Web" Path="~/Scripts/WebForms/WebParts.js" />
                <asp:ScriptReference Name="Focus.js" Assembly="System.Web" Path="~/Scripts/WebForms/Focus.js" />
                <asp:ScriptReference Name="WebFormsBundle" />
                <%--Site Scripts--%>
            </Scripts>
        </asp:ScriptManager>

        <div class="navbar navbar-inverse navbar-fixed-top">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" runat="server" href="~/">應用程式名稱</a>
                </div>
                <div class="navbar-collapse collapse">
                    <ul class="nav navbar-nav">
                        <li><a runat="server" href="~/">首頁</a></li>
                        <li><a runat="server" href="~/productList">商品清單</a></li>
                        <li><a runat="server" href="~/cart">購物車</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="container body-content">
            <asp:ContentPlaceHolder ID="MainContent" runat="server">
            </asp:ContentPlaceHolder>
            <hr />
            <footer>
                <p>&copy; <%: DateTime.Now.Year %> - 我的 ASP.NET  應用程式</p>
            </footer>
        </div>

    </form>
</body>
</html>

using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;

namespace 組別作品
{
    public partial class SiteMaster : MasterPage
    {
        public static string s_data = @"Data Source=(localdb)\MSSQLLocalDB;Initial Catalog=測試用資料庫01;Integrated Security=True";//可變動的
        protected void Page_Load(object sender, EventArgs e)
        {
        }
    }
}
//------------------------------------------------------------------------------
// <自動產生的>
//     這段程式碼是由工具產生的。
//
//     變更這個檔案可能會導致不正確的行為，而且如果已重新產生
//     程式碼，則會遺失變更。
// </自動產生的>
//------------------------------------------------------------------------------

namespace 組別作品
{


    public partial class SiteMaster
    {

        /// <summary>
        /// MainContent 控制項。
        /// </summary>
        /// <remarks>
        /// 自動產生的欄位。
        /// 若要修改，請將欄位宣告從設計工具檔案移到程式碼後置檔案。
        /// </remarks>
        protected global::System.Web.UI.WebControls.ContentPlaceHolder MainContent;
    }
}

<%@ Page Title="" Language="C#" MasterPageFile="~/Site.Master" AutoEventWireup="true" CodeBehind="addToCart.aspx.cs" Inherits="組別作品.addToCart" %>
<asp:Content ID="Content1" ContentPlaceHolderID="MainContent" runat="server">



</asp:Content>

using System;
using System.Collections.Generic;
using System.Data;
using System.Data.SqlClient;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;

namespace 組別作品
{
    public partial class addToCart : System.Web.UI.Page
    {
        protected void Page_Load(object sender, EventArgs e)
        {

            //Session["cart"]+=Request.QueryString["productID"]+"&";//存入的是字串，所以用&分隔開，要用時要另外解析
            //if (Session[Request.QueryString["productID"]]!=)
            //{

            //}
            //Session[Request.QueryString["productID"]]=Session[$"{Request.QueryString["productID"]}"]+1;
            //int j = Session.Contents.Count;
            //for (int i = 0; i <j; i++)
            //{
            //    Response.Write(Session.Contents[i]+"</br>");
            //}
                
       
//==============================================
            ////加到訂單sql
            //string s_data = @"Data Source=(localdb)\MSSQLLocalDB;Initial Catalog=測試用資料庫01;Integrated Security=True";
            //SqlConnection connection = new SqlConnection(s_data);
            //connection.Open();
            //string sql = $"insert into [Orderdetail](productID) values (@productID)";
            //SqlCommand command = new SqlCommand(sql, connection);

            //command.Parameters.Add("@productID", SqlDbType.Int);
            //command.Parameters["@productID"].Value = Request.QueryString["productID"];
            //command.ExecuteNonQuery();

            //connection.Close();
//===============================================

            //Server.Transfer("productList.aspx");//轉回頁面


        }
    }
}
//------------------------------------------------------------------------------
// <自動產生的>
//     這段程式碼是由工具產生的。
//
//     變更這個檔案可能會導致不正確的行為，而且如果已重新產生
//     程式碼，則會遺失變更。
// </自動產生的>
//------------------------------------------------------------------------------

namespace 組別作品
{


    public partial class addToCart
    {
    }
}

<%@ Page Title="" Language="C#" MasterPageFile="~/Site.Master" AutoEventWireup="true" CodeBehind="cart.aspx.cs" Inherits="組別作品.cart" %>
<asp:Content ID="Content1" ContentPlaceHolderID="MainContent" runat="server">

    <asp:Panel ID="Panel0" runat="server">
        <asp:Label ID="Label2" runat="server" Text="商品" Width="33%"></asp:Label>
        <asp:Label ID="Label3" runat="server" Text="數量" Width="33%"></asp:Label>
        <asp:Label ID="Label4" runat="server" Text="小計" Width="33%"></asp:Label>
    </asp:Panel>

        <asp:Panel ID="Panel1" runat="server">
            
    </asp:Panel>
    <asp:Panel ID="Panel2" runat="server" HorizontalAlign="Right">
        <asp:Label ID="Label1" runat="server" Text="合計:"></asp:Label>
        <asp:Label ID="lb_total" runat="server" Text="0"></asp:Label>
        <br />
        <br />
        <asp:Button ID="btn_checkout" runat="server" Text="結帳" OnClick="btn_checkout_Click" />

    </asp:Panel>
    

</asp:Content>

using System;
using System.Collections;
using System.Collections.Generic;
using System.Data.SqlClient;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;

namespace 組別作品
{
    public partial class cart : System.Web.UI.Page
    {
        public string s_data = SiteMaster.s_data;
        public string custermer = "123@123";//可變動的
        public int custermerID = 1;//可變動的

        public List<string> cartList = new List<string>();
        public HashSet<string> cartSet = new HashSet<string>();//紀錄有多少種商品

        protected void Page_Load(object sender, EventArgs e)
        {

            pageUpdate(sender,e);

       
         }

        public void pageUpdate(object sender, EventArgs e)
        {
            #region 取得購物車資料
            cartList.Clear();
            cartSet.Clear();
            SqlConnection connection = new SqlConnection(s_data);
            string sql = $"select * from cart_{custermer} order by productID";
            SqlCommand sqlCommand = new SqlCommand(sql, connection);
            connection.Open();
            SqlDataReader reader = sqlCommand.ExecuteReader();
            if (reader.HasRows)
                while (reader.Read())
                {
                    cartList.Add("" + reader["productID"]);
                    cartSet.Add("" + reader["productID"]);
                }
            connection.Close();
            #endregion

            Panel1.Controls.Clear();

            int total = 0;
            //計算每種商品有多少個&計算價格
            foreach (var item in cartSet)//多少種
            {
                int i = 0;
                # region 取得單價
                int singlePrice = 0;
                sql = $"select * from products where id={item}";
                sqlCommand = new SqlCommand(sql, connection);
                connection.Open();
                reader = sqlCommand.ExecuteReader();
                if (reader.HasRows)
                {
                    while (reader.Read())
                    {
                        singlePrice = int.Parse(reader["price"].ToString());
                    }
                }
                connection.Close();

                #endregion
                foreach (var b in cartList)//每種有幾個
                {
                    if (b == item)
                        i++;
                }
                #region html生成

                Panel productBox = new Panel();
                productBox.CssClass = "product_box";
                Panel1.Controls.Add(productBox);

                Label lb_title = new Label();
                #region 從商品ID取得商品名字
                string productName = "";
                sql = $"select * from products where id={item}";
                 sqlCommand = new SqlCommand(sql, connection);
                connection.Open();
                reader = sqlCommand.ExecuteReader();
                if (reader.HasRows)
                {
                    while (reader.Read())
                    {
                        productName =""+ reader["title"];
                    }
                }
                connection.Close();

                #endregion
                lb_title.Text = $"商品:{item.ToString()}{productName}    數量:";
                productBox.Controls.Add(lb_title);

                Label lb_amount = new Label();
                lb_amount.Text = $"{i}";
                productBox.Controls.Add(lb_amount);

                Button btn_add = new Button();
                btn_add.Text = "+1";
                btn_add.CssClass = $"{item}";//存放productID
                btn_add.Click += new EventHandler(this.add);
                productBox.Controls.Add(btn_add);

                Button btn_minus = new Button();
                btn_minus.Text = "-1";
                btn_minus.CssClass = $"{item}";//存放productID
                btn_minus.Click += new EventHandler(this.minus);
                productBox.Controls.Add(btn_minus);

                Label lb_subtotalTxt = new Label();
                lb_subtotalTxt.Text = "小計:";
                productBox.Controls.Add(lb_subtotalTxt);

                Label lb_subtotal = new Label();//單一種類總價
                lb_subtotal.Text = ""+i*singlePrice;
                productBox.Controls.Add(lb_subtotal);

                total += int.Parse(lb_subtotal.Text);//計算總共的金額

                Button btn_deleteAll = new Button();
                btn_deleteAll.Text = "刪除";
                btn_deleteAll.CssClass = $"{item}";//存放productID
                btn_deleteAll.Click += new EventHandler(this.deleteAll);
                productBox.Controls.Add(btn_deleteAll);
                #endregion
            }
            lb_total.Text =""+ total;
        }

        public void minus(object sender, EventArgs e)
        {
            Button btn = (Button)sender;
            Panel productBox = (Panel)btn.Parent;//取得包裹它的容器，再轉型成要的html物件
            Label amount = (Label)FindControl(btn.Parent.Controls[1].UniqueID);//取得包裹它的容器，再取得容器的第0個control，再轉型成要的html物件
            Label subtotal = (Label)FindControl(btn.Parent.Controls[5].UniqueID);

            #region 從sql把購物車商品減1
            if (int.Parse(amount.Text) > 1)
            {
                SqlConnection connection = new SqlConnection(s_data);
                string sql = $"delete top(1) from cart_{custermer} where productID={btn.CssClass}";//刪除1個資料
                SqlCommand sqlCommand = new SqlCommand(sql, connection);
                connection.Open();
                sqlCommand.ExecuteNonQuery();
                connection.Close();

            #endregion

                #region 取得資料&計算商品有多少個
                int count = 0;
                connection = new SqlConnection(s_data);
                sql = $"select * from cart_123@123 where productID={btn.CssClass}";
                sqlCommand = new SqlCommand(sql, connection);
                connection.Open();
                SqlDataReader reader = sqlCommand.ExecuteReader();
                if (reader.HasRows)
                {
                    while (reader.Read())
                    {
                        count++;
                    }
                }
                connection.Close();
                #endregion

                amount.Text = "" + count;


                #region 取得單價
                int price = 0;
                sql = $"select * from products where id={btn.CssClass}";
                sqlCommand = new SqlCommand(sql, connection);
                connection.Open();
                reader = sqlCommand.ExecuteReader();
                if (reader.HasRows)
                {
                    while (reader.Read())
                    {
                        price = int.Parse(reader["price"].ToString());
                    }
                }
                connection.Close();

                #endregion
                subtotal.Text = "" + count * price;
                lb_total.Text = "" + (int.Parse(lb_total.Text) - price);
            }
        }

        public void add(object sender, EventArgs e)
        {
            Button btn = (Button)sender;
            Panel productBox = (Panel)btn.Parent;//取得包裹它的容器，再轉型成要的html物件
            Label amount = (Label)FindControl(btn.Parent.Controls[1].UniqueID);//取得包裹它的容器，再取得容器的第0個control，再轉型成要的html物件
            Label subtotal = (Label)FindControl(btn.Parent.Controls[5].UniqueID);
            

            #region 從sql把購物車商品+1
            SqlConnection connection = new SqlConnection(s_data);
            string sql = $"insert [cart_{custermer}](productID)values({btn.CssClass}) ";
            SqlCommand sqlCommand = new SqlCommand(sql, connection);
            connection.Open();
            sqlCommand.ExecuteNonQuery();
            connection.Close();

            #endregion

            #region 取得資料&計算商品有多少個
            int count = 0;
            connection = new SqlConnection(s_data);
            sql = $"select * from cart_{custermer} where productID={btn.CssClass}";
            sqlCommand = new SqlCommand(sql, connection);
            connection.Open();
            SqlDataReader reader = sqlCommand.ExecuteReader();
            if (reader.HasRows)
            {
                while (reader.Read())
                {
                    count++;
                }
            }
            connection.Close();
            #endregion
            amount.Text = "" + count;

            #region 取得單價
            int price = 0;
            sql = $"select * from products where id={btn.CssClass}";
            sqlCommand = new SqlCommand(sql, connection);
            connection.Open();
            reader = sqlCommand.ExecuteReader();
            if (reader.HasRows)
                while (reader.Read())
                {
                    price = int.Parse(reader["price"].ToString());
                }
            connection.Close();

            #endregion
            subtotal.Text =""+ count * price;
            lb_total.Text = "" + (int.Parse(lb_total.Text) +price);

        }

        public void deleteAll(object sender,EventArgs e)
        {
            Button btn = (Button)sender;
            Panel productBox = (Panel)btn.Parent;//取得包裹它的容器
            Label amount = (Label)FindControl(btn.Parent.Controls[1].UniqueID);//取得包裹它的容器，再取得容器的第0個control，再轉型成要的html物件

            #region 單一商品全部移出購物車
            SqlConnection connection = new SqlConnection(s_data);
            string sql = $"delete from cart_{custermer} where productID={btn.CssClass}";//刪除1個資料
            SqlCommand sqlCommand = new SqlCommand(sql, connection);
            connection.Open();
            sqlCommand.ExecuteNonQuery();
            connection.Close();
            #endregion

            productBox.Controls.Clear();//先暫時這樣，因為如果使用productBox.Visible=false會造成ID更動而影響顯示


            #region 取得單價
            int price = 0;
            sql = $"select * from products where id={btn.CssClass}";
            sqlCommand = new SqlCommand(sql, connection);
            connection.Open();
            SqlDataReader reader = sqlCommand.ExecuteReader();
            if (reader.HasRows)
                while (reader.Read())
                {
                    price = int.Parse(reader["price"].ToString());
                }
            connection.Close();

            #endregion

            lb_total.Text = "" +(int.Parse(lb_total.Text)-price*int.Parse(amount.Text));

            

        }

        protected void btn_checkout_Click(object sender, EventArgs e)
        {

            foreach (var item in cartSet)
            {
                int amount = 0;
                foreach (var b in cartList)
                {
                    if (b==item)
                    {
                        amount++;
                    }
                }
                #region 取得price資料
                int price = 0;
                SqlConnection connection = new SqlConnection(s_data);
                string sql = $"select * from products where id={item}";
                SqlCommand sqlCommand = new SqlCommand(sql, connection);
                connection.Open();
                SqlDataReader reader = sqlCommand.ExecuteReader();
                if (reader.HasRows)
                    while (reader.Read())
                    {
                           price = int.Parse(reader["price"].ToString());
                    }
                connection.Close();
                #endregion

                #region 從商品ID取得商品名字
                string productName = "";
                sql = $"select * from products where id={item}";
                sqlCommand = new SqlCommand(sql, connection);
                connection.Open();
                reader = sqlCommand.ExecuteReader();
                if (reader.HasRows)
                {
                    while (reader.Read())
                    {
                        productName = "" + reader["title"];
                    }
                }
                connection.Close();
                #endregion

                #region 確定下單，資料放入dbo.Oderdtail
                connection = new SqlConnection(s_data);
                sql = $"insert [Orderdetail](productID,amount,total,customersID,customerName)values({int.Parse(item)},{amount},{price * amount},{custermerID},'{custermer}') ";
                sqlCommand = new SqlCommand(sql, connection);
                connection.Open();
                sqlCommand.ExecuteNonQuery();
                connection.Close();
                #endregion

            }


        }
        }
}
//------------------------------------------------------------------------------
// <自動產生的>
//     這段程式碼是由工具產生的。
//
//     變更這個檔案可能會導致不正確的行為，而且如果已重新產生
//     程式碼，則會遺失變更。
// </自動產生的>
//------------------------------------------------------------------------------

namespace 組別作品
{


    public partial class cart
    {

        /// <summary>
        /// Panel0 控制項。
        /// </summary>
        /// <remarks>
        /// 自動產生的欄位。
        /// 若要修改，請將欄位宣告從設計工具檔案移到程式碼後置檔案。
        /// </remarks>
        protected global::System.Web.UI.WebControls.Panel Panel0;

        /// <summary>
        /// Label2 控制項。
        /// </summary>
        /// <remarks>
        /// 自動產生的欄位。
        /// 若要修改，請將欄位宣告從設計工具檔案移到程式碼後置檔案。
        /// </remarks>
        protected global::System.Web.UI.WebControls.Label Label2;

        /// <summary>
        /// Label3 控制項。
        /// </summary>
        /// <remarks>
        /// 自動產生的欄位。
        /// 若要修改，請將欄位宣告從設計工具檔案移到程式碼後置檔案。
        /// </remarks>
        protected global::System.Web.UI.WebControls.Label Label3;

        /// <summary>
        /// Label4 控制項。
        /// </summary>
        /// <remarks>
        /// 自動產生的欄位。
        /// 若要修改，請將欄位宣告從設計工具檔案移到程式碼後置檔案。
        /// </remarks>
        protected global::System.Web.UI.WebControls.Label Label4;

        /// <summary>
        /// Panel1 控制項。
        /// </summary>
        /// <remarks>
        /// 自動產生的欄位。
        /// 若要修改，請將欄位宣告從設計工具檔案移到程式碼後置檔案。
        /// </remarks>
        protected global::System.Web.UI.WebControls.Panel Panel1;

        /// <summary>
        /// Panel2 控制項。
        /// </summary>
        /// <remarks>
        /// 自動產生的欄位。
        /// 若要修改，請將欄位宣告從設計工具檔案移到程式碼後置檔案。
        /// </remarks>
        protected global::System.Web.UI.WebControls.Panel Panel2;

        /// <summary>
        /// Label1 控制項。
        /// </summary>
        /// <remarks>
        /// 自動產生的欄位。
        /// 若要修改，請將欄位宣告從設計工具檔案移到程式碼後置檔案。
        /// </remarks>
        protected global::System.Web.UI.WebControls.Label Label1;

        /// <summary>
        /// lb_total 控制項。
        /// </summary>
        /// <remarks>
        /// 自動產生的欄位。
        /// 若要修改，請將欄位宣告從設計工具檔案移到程式碼後置檔案。
        /// </remarks>
        protected global::System.Web.UI.WebControls.Label lb_total;

        /// <summary>
        /// btn_checkout 控制項。
        /// </summary>
        /// <remarks>
        /// 自動產生的欄位。
        /// 若要修改，請將欄位宣告從設計工具檔案移到程式碼後置檔案。
        /// </remarks>
        protected global::System.Web.UI.WebControls.Button btn_checkout;
    }
}

<%@ Page Title="" Language="C#" MasterPageFile="~/Site.Master" AutoEventWireup="true" CodeBehind="productDetail.aspx.cs" Inherits="組別作品.WebForm2" %>
<asp:Content ID="Content1" ContentPlaceHolderID="MainContent" runat="server">

    商品細節
    <asp:Panel ID="Panel1" runat="server">
        <asp:Label ID="lb_title" runat="server" Text="Label"></asp:Label>
        <br/>
        <asp:Label ID="lb_price" runat="server" Text="Label"></asp:Label>
        <asp:Button ID="btn_addToCart" runat="server" Text="加入購物車" OnClick="btn_addToCart_Click" />
        <br />
        <asp:Label ID="lb_describe" runat="server" Text="Label"></asp:Label>
        
    </asp:Panel>



</asp:Content>
